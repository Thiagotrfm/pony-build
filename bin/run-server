#! /usr/bin/env python
import sys
import _mypath
from pony_build import server, basic_web, coordinator
import shelve

HOST=''
PORT=int(sys.argv[2])

try:
    dbfile = shelve.open(sys.argv[1])
except IOError:
    dbfile = shelve.open(sys.argv[1], 'c')

pbs_app = coordinator.PonyBuildCoordinator(db=dbfile)
web_app = basic_web.BasicWebApp(pbs_app)

the_server = server.create(HOST, PORT, pbs_app, web_app.wsgi_interface)

try:
    print 'serving on host %s, port %d, path /xmlrpc' % (HOST, PORT)
    the_server.serve_forever()
except KeyboardInterrupt:
    print 'exiting'
