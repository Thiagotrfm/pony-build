#! /usr/bin/env python
import sys
import _mypath
import shelve
from pony_build import coordinator

package = sys.argv[1]
dbfile = shelve.open(sys.argv[2])
arch = sys.argv[3]
tags = sys.argv[4]
tagset = set(tags.split(','))

coord = coordinator.PonyBuildCoordinator(db=dbfile)

flush = []
for i, (receipt, client_info, results_list) in enumerate(coord.results_list):
    if client_info['package'] == package and \
       set(client_info['tags']) == tagset and client_info['arch'] == arch:
        flush.append(i)

for k in flush:
    del dbfile[str(k)]

dbfile.close()

