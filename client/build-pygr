#! /usr/bin/env python
import sys
from pony_build_client import BuildCommand, TestCommand, do
import os
import tempfile
import shutil

repo_url = '/Users/t/dev/pygr'

name = 'pygr'
#server_url = 'http://localhost:8080/xmlrpc'
server_url = 'http://lyorn.idyll.org/ctb/pb-dev/xmlrpc'

commands = [ BuildCommand(['git', 'clone', repo_url],
                          name='checkout'),
             BuildCommand(['python', 'setup.py', 'build_ext', '-i'],
                          name='compile', run_cwd='pygr'),
             TestCommand(['python', 'runtest.py', 'seqdb_test.py'],
                         name='run seqdb_test', run_cwd='pygr/tests')
             ]

rundir = tempfile.mkdtemp()
print 'running in', rundir
os.chdir(rundir)
try:
    do(name, commands, server_url, hostname='laptop')
finally:
    shutil.rmtree(rundir)
